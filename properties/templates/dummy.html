  {% extends 'base.html' %}

  {% block content %}
  {% load static %}

  <main class="main">

    <!-- Page Title -->
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Contact</h1>
              <p class="mb-0">Odio et unde deleniti. Deserunt numquam exercitationem. Officiis quo odio sint voluptas consequatur ut a odio voluptatem. Sit dolorum debitis veritatis natus dolores. Quasi ratione sint. Sit quaerat ipsum dolorem.</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="{% url 'index' %}">Home</a></li>
            <li class="current">Contact</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->

    <!-- Contact Section -->
    <section id="contact" class="contact section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="mb-4" data-aos="fade-up" data-aos-delay="200">
          <iframe style="border:0; width: 100%; height: 270px;" src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d48389.78314118045!2d-74.006138!3d40.710059!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c25a22a3bda30d%3A0xb89d1fe6bc499443!2sDowntown%20Conference%20Center!5e0!3m2!1sen!2sus!4v1676961268712!5m2!1sen!2sus" frameborder="0" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div><!-- End Google Maps -->

        <div class="row gy-4">

          <div class="col-lg-4">
            <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="300">
              <i class="bi bi-geo-alt flex-shrink-0"></i>
              <div>
                <h3>Address</h3>
                <p>A108 Adam Street, New York, NY 535022</p>
              </div>
            </div><!-- End Info Item -->

            <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="400">
              <i class="bi bi-telephone flex-shrink-0"></i>
              <div>
                <h3>Call Us</h3>
                <p>+1 5589 55488 55</p>
              </div>
            </div><!-- End Info Item -->

            <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="500">
              <i class="bi bi-envelope flex-shrink-0"></i>
              <div>
                <h3>Email Us</h3>
                <p>info@example.com</p>
              </div>
            </div><!-- End Info Item -->

          </div>

          <div class="col-lg-8">
            <form action="" method="post" name="feedback" data-aos="fade-up" data-aos-delay="200">
              <div class="row gy-4">

                <div class="col-md-6">
                  <input type="text" name="name" class="form-control" placeholder="Your Name" required="">
                </div>

                <div class="col-md-6 ">
                  <input type="email" class="form-control" name="email" placeholder="Your Email" required="">
                </div>

                <div class="col-md-12">
                  <input type="text" class="form-control" name="subject" placeholder="Subject" required="">
                </div>

                <div class="col-md-12">
                  <textarea class="form-control" name="message" rows="6" placeholder="Message" required=""></textarea>
                </div>

                <div class="col-md-12 text-center">
                  <div class="loading">Loading</div>
                  <div class="error-message"></div>
                  <div class="sent-message">Your message has been sent. Thank you!</div>

                  <button type="submit">Send Message</button>
                </div>

              </div>
            </form>
          </div><!-- End Contact Form -->

        </div>

      </div>

    </section><!-- /Contact Section -->

  </main>

 {% endblock %}

<!--  property-->

  {% extends 'base.html' %}

{% block content %}
{% load static %}

  <main class="main">

    <!-- Page Title -->
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Properties</h1>
              <p class="mb-0">Odio et unde deleniti. Deserunt numquam exercitationem. Officiis quo odio sint voluptas consequatur ut a odio voluptatem. Sit dolorum debitis veritatis natus dolores. Quasi ratione sint. Sit quaerat ipsum dolorem.</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="{% url 'index' %}">Home</a></li>
            <li class="current">Properties</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->

    <!-- Real Estate Section -->
    <section id="real-estate" class="real-estate section">

      <div class="container">

        <div class="row gy-4">

          {% for property in data %}

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
            <div class="card">
              <img src="{% static 'style/img/properties/property-1.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Rent | $1200</span>
                <h3><a href="propertysingle.html" class="stretched-link">204 Mount Olive Road Two</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">{{ property.area }}</div>
                    <div class="col">{{ property.beds }}</div>
                    <div class="col">{{ property.baths }}</div>
                    <div class="col">{{ property.garage }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="200">
            <div class="card">
              <img src="{% static 'style/img/properties/property-2.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Sale | $350.000</span>
                <h3><a href="propertysingle.html" class="stretched-link">647 Molie Road</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">340m2</div>
                    <div class="col">5</div>
                    <div class="col">2</div>
                    <div class="col">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="300">
            <div class="card">
              <img src="{% static 'style/img/properties/property-3.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Sale | $580.000</span>
                <h3><a href="propertysingle.html" class="stretched-link">711 Avenue Road</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">340m2</div>
                    <div class="col">5</div>
                    <div class="col">2</div>
                    <div class="col">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="400">
            <div class="card">
              <img src="{% static 'style/img/properties/property-4.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Rent | $6500</span>
                <h3><a href="propertysingle.html" class="stretched-link">117 Milk Road</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">340m2</div>
                    <div class="col">5</div>
                    <div class="col">2</div>
                    <div class="col">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="500">
            <div class="card">
              <img src="{% static 'style/img/properties/property-5.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Rent | $3000</span>
                <h3><a href="propertysingle.html" class="stretched-link">678 Broad Road</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">340m2</div>
                    <div class="col">5</div>
                    <div class="col">2</div>
                    <div class="col">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

          <div class="col-xl-4 col-md-6" data-aos="fade-up" data-aos-delay="600">
            <div class="card">
              <img src="{% static 'style/img/properties/property-6.jpg' %}" alt="" class="img-fluid">
              <div class="card-body">
                <span class="sale-rent">Sale | $650.000</span>
                <h3><a href="propertysingle.html" class="stretched-link">974 Denim Road</a></h3>
                <div class="card-content d-flex flex-column justify-content-center text-center">
                  <div class="row propery-info">
                    <div class="col">Area</div>
                    <div class="col">Beds</div>
                    <div class="col">Baths</div>
                    <div class="col">Garages</div>
                  </div>
                  <div class="row">
                    <div class="col">340m2</div>
                    <div class="col">5</div>
                    <div class="col">2</div>
                    <div class="col">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- End Property Item -->

        </div>

      </div>

    </section><!-- /Real Estate Section -->

  </main>

{% endblock %}

<!--class dump-->
  class Single(models.Model):
    title = models.CharField(max_length=255, default='Incredible',)
    image = models.ImageField(upload_to='images/')
    key = models.IntegerField()
    location = models.CharField(max_length=100, default='Nairobi')
    type = models.CharField(max_length=50, default='House')
    status = models.CharField(max_length=50, default='Pending')
    area = models.CharField(max_length=100, default=0)
    beds = models.IntegerField()
    baths = models.IntegerField()

    def __str__(self):
        return self.title

  css
  .testimonials .testimonial-item .testimonial-img {
  width: 90px;
  border-radius: 0;
  border: 4px solid var(--background-color);
  margin: 0 auto;
}

<!--  Cart View Functionality-->
      <ul>
        {% for key, item in cart.items %}
        <li>
            <img src="{{ item.image }}" alt="{{ item.title }}">
            <p>{{ item.title }}</p>
            <p>Quantity: {{ item.quantity }}</p>
            <p>Price: {{ item.price }}</p>
        </li>
        {% endfor %}
      </ul>

<!--  context_processors.cart.py-->
class Cart():
    def __init__(self, request):
        self.session = request.session

        cart = self.session.get('session_key')

        if 'session_key' not in request.session:
            cart = self.session.get['session_key'] = {}



        self.cart = cart
       billing form
    <div class="form-group">
        <label for="id_first_name">First Name</label>
        {{ form.first_name }}
    </div>
    <div class="form-group">
        <label for="id_last_name">Last Name</label>
        {{ form.last_name }}
    </div>
    <div class="form-group">
        <label for="id_address">Address</label>
        {{ form.address }}
    </div>
    <div class="form-group">
        <label for="id_city">City</label>
        {{ form.city }}
    </div>
    <div class="form-group">
        <label for="id_postal_code">Postal Code</label>
        {{ form.postal_code }}
    </div>
    <div class="form-group">
        <label for="id_country">Country</label>
        {{ form.country }}
    </div>
    <div class="form-group">
        <label for="id_phone">Phone</label>
        {{ form.phone }}
    </div>
    <div class="form-group">
        <label for="id_email">Email</label>
        {{ form.email }}
    </div>
<!--  cart-->
  from visitor.models import Profile
from properties.models import Property
# from cart.models import CartItem
from decimal import Decimal

class Cart:
    def __init__(self, request):
        self.session = request.session
        self.request = request
        cart = self.session.get('session_key')

        if cart is None:
            cart = self.session['session_key'] = {}

        self.cart = cart

    def add(self, product, quantity=1, update_quantity=False):
        product_id = str(product.id)
        if product_id not in self.cart:
            self.cart[product_id] = {'quantity': 0, 'price': str(product.price)}
        if update_quantity:
            self.cart[product_id]['quantity'] = quantity
        else:
            self.cart[product_id]['quantity'] += quantity
        self.save()

    def save(self):
        self.session.modified = True
        if self.request.user.is_authenticated:
            current_user = Profile.objects.filter(user=self.request.user)
            cart_data = str(self.cart).replace("'", "\"")
            current_user.update(old_cart=cart_data)

    def remove(self, product):
        product_id = str(product.id)
        if product_id in self.cart:
            del self.cart[product_id]
            self.save()

    def clear(self):
        self.session['session_key'] = {}
        self.save()

    def __iter__(self):
        product_ids = self.cart.keys()
        products = Property.objects.filter(id__in=product_ids)
        cart = self.cart.copy()
        for product in products:
            cart[str(product.id)]['product'] = product
        for item in cart.values():
            item['price'] = Decimal(item['price'])
            item['total_price'] = item['price'] * item['quantity']
            yield item

    def __len__(self):
        return sum(item['quantity'] for item in self.cart.values())

    def get_total_price(self):
        return sum(Decimal(item['price']) * item['quantity'] for item in self.cart.values())

    def db_add(self, product, quantity=1, update_quantity=False):
        product_id = str(product)
        if product_id not in self.cart:
            self.cart[product_id] = {'quantity': 0, 'price': str(product.price)}
        if update_quantity:
            self.cart[product_id]['quantity'] = quantity
        else:
            self.cart[product_id]['quantity'] += quantity
        self.save()

    def save(self):
        self.session.modified = True
        if self.request.user.is_authenticated:
            current_user = Profile.objects.filter(user=self.request.user)
            cart_data = str(self.cart).replace("\'", "\"")
            current_user.update(old_cart=cart_data)
<!--           views.py cart-->
  from django.shortcuts import render, redirect, get_object_or_404
from django.contrib import messages
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from properties.models import Property
from cart.models import Purchase
from visitor.models import Profile
from .cart import Cart
import json

# Display Cart
def cart(request):
    cart = Cart(request)
    context = {'cart': cart}
    return render(request, 'cart.html', context)

# Add Property to Cart
def add_to_cart(request, property_id):
    product = get_object_or_404(Property, id=property_id)
    cart = Cart(request)

    cart.add(product=product)
    messages.success(request, f'Added {product.title} to cart.')

    return redirect('properties')


# Remove Property from Cart
def remove_from_cart(request, property_id):
    product = get_object_or_404(Property, id=property_id)
    cart = Cart(request)

    cart.remove(product)
    messages.success(request, 'Item removed from cart.')

    return redirect('cart')

# Buy Property from Cart
@login_required
def buy_property(request, property_id):
    return redirect('billing', property_id=property_id)

# User Login
def login_user(request):
    if request.method == 'POST':
        email = request.POST.get('username')  # Use 'username' for email
        password = request.POST.get('password')
        user = authenticate(request, username=email, password=password)
        if user is not None:
            login(request, user)
            current_user = Profile.objects.get(user__id=request.user.id)
            saved_cart = current_user.old_cart

            if saved_cart:
                converted_cart = json.loads(saved_cart)
                cart = Cart(request)

                for product_id, item in converted_cart.items():
                    product = Property.objects.get(id=int(product_id))
                    cart.db_add(product=product, quantity=item['quantity'], update_quantity=True)

            messages.success(request, 'You are now logged in.')
            return redirect('index')
        else:
            messages.error(request, 'Invalid email or password.')
            return redirect('login')
    return render(request, 'login.html')
<!--models visitor-->
  from django.conf import settings
from django.contrib.auth.models import AbstractBaseUser, BaseUserManager, PermissionsMixin
from django.db import models
from django.utils import timezone
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver

class NewUserManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        if not email:
            raise ValueError('The Email field must be set')
        email = self.normalize_email(email)
        user = self.model(email=email, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        return self.create_user(email, password, **extra_fields)

class NewUser(AbstractBaseUser, PermissionsMixin):
    email = models.EmailField(unique=True)
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=30)
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False)
    date_joined = models.DateTimeField(default=timezone.now)

    objects = NewUserManager()

    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['first_name', 'last_name']

    def __str__(self):
        return f"{self.first_name} {self.last_name} ({self.email})"

    # Optional: permissions logic can be customized as required
    def has_perm(self, perm, obj=None):
        return self.is_superuser or super().has_perm(perm, obj)

    def has_module_perms(self, app_label):
        return self.is_superuser or super().has_module_perms(app_label)

class Profile(models.Model):
    user = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True)
    date_modified = models.DateTimeField(auto_now=True)
    phone = models.CharField(max_length=20, blank=True)
    address1 = models.CharField(max_length=50, blank=True)
    address2 = models.CharField(max_length=50, blank=True)
    city = models.CharField(max_length=50, blank=True)
    zipcode = models.CharField(max_length=50, blank=True)
    country = models.CharField(max_length=50, blank=True)
    old_cart = models.JSONField(blank=True, null=True)

    def __str__(self):
        return self.user.email if self.user else "Unlinked Profile"


# Signals to create and save profile
@receiver(post_save, sender=settings.AUTH_USER_MODEL)
def create_profile(sender, instance, created, **kwargs):
    if created:
        Profile.objects.create(user=instance)

@receiver(post_save, sender=settings.AUTH_USER_MODEL)
def save_profile(sender, instance, **kwargs):
    instance.profile.save()

@receiver(post_delete, sender=settings.AUTH_USER_MODEL)
def delete_profile(sender, instance, **kwargs):
    instance.profile.delete()  # Ensure the profile is deleted when the user is deleted



  from django.conf import settings
from django.contrib.auth.models import AbstractBaseUser, BaseUserManager, PermissionsMixin
from django.db import models
from django.utils import timezone
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver

class NewUserManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        if not email:
            raise ValueError('The Email field must be set')
        email = self.normalize_email(email)
        extra_fields.setdefault('is_staff', False)
        extra_fields.setdefault('is_active', True)
        user = self.model(email=email, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        return self.create_user(email, password, **extra_fields)

class NewUser(AbstractBaseUser, PermissionsMixin):
    email = models.EmailField(unique=True)
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=30)
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False)
    date_joined = models.DateTimeField(default=timezone.now)

    objects = NewUserManager()

    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['first_name', 'last_name']

    def __str__(self):
        return f"{self.first_name} {self.last_name} ({self.email})"

    def has_perm(self, perm, obj=None):
        return self.is_superuser or super().has_perm(perm, obj)

    def has_module_perms(self, app_label):
        return self.is_superuser or super().has_module_perms(app_label)

class Profile(models.Model):
    user = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True)
    date_modified = models.DateTimeField(auto_now=True)
    phone = models.CharField(max_length=20, blank=True)
    address1 = models.CharField(max_length=50, blank=True)
    address2 = models.CharField(max_length=50, blank=True)
    city = models.CharField(max_length=50, blank=True)
    zipcode = models.CharField(max_length=50, blank=True)
    country = models.CharField(max_length=50, blank=True)
    old_cart = models.JSONField(blank=True, null=True)

    def __str__(self):
        return self.user.email if self.user else "Unlinked Profile"

@receiver(post_save, sender=settings.AUTH_USER_MODEL)
def create_profile(sender, instance, created, **kwargs):
    if created:
        Profile.objects.create(user=instance)

@receiver(post_delete, sender=settings.AUTH_USER_MODEL)
def delete_profile(sender, instance, **kwargs):
    if hasattr(instance, 'profile'):
        instance.profile.delete()

<!--   cart.py-->
  import json
from decimal import Decimal
from visitor.models import Profile
from properties.models import Property

class Cart:
    def __init__(self, request):
        self.session = request.session
        self.request = request
        self.cart = self.session.get('cart', {})  # Use 'cart' as the session key
        if not self.cart:
            self.session['cart'] = self.cart

    def add(self, product, quantity=1, update_quantity=False):
        product_id = str(product.id)
        if product_id not in self.cart:
            self.cart[product_id] = {'quantity': 0, 'price': str(product.price)}
        if update_quantity:
            self.cart[product_id]['quantity'] = quantity
        else:
            self.cart[product_id]['quantity'] += quantity
        self._save_to_session()

    def remove(self, product):
        product_id = str(product.id)
        if product_id in self.cart:
            del self.cart[product_id]
            self._save_to_session()

    def clear(self):
        self.cart = {}
        self._save_to_session()

    def __iter__(self):
        product_ids = self.cart.keys()
        products = Property.objects.filter(id__in=product_ids)
        cart_copy = self.cart.copy()
        for product in products:
            product_id = str(product.id)
            cart_copy[product_id]['product'] = product
        for item in cart_copy.values():
            item['price'] = Decimal(item['price'])
            item['total_price'] = item['price'] * item['quantity']
            yield item

    def __len__(self):
        return sum(item['quantity'] for item in self.cart.values())

    def get_total_price(self):
        return sum(Decimal(item['price']) * item['quantity'] for item in self.cart.values())

    def _save_to_session(self):
        self.session['cart'] = self.cart
        self.session.modified = True
        if self.request.user.is_authenticated:
            self._save_to_profile()

    def _save_to_profile(self):
        # Save cart data to the user profile (if applicable)
        try:
            current_user = Profile.objects.get(user=self.request.user)
            cart_data = json.dumps(self.cart)  # Safely serialize to JSON
            current_user.old_cart = cart_data  # Ensure 'old_cart' is a JSONField
            current_user.save()
        except Profile.DoesNotExist:
            pass  # Handle the case where the profile doesn't exist

    def load_cart_from_profile(self):
        if self.request.user.is_authenticated:
            try:
                current_user = Profile.objects.get(user=self.request.user)
                saved_cart = current_user.old_cart
                if saved_cart:
                    # Load cart from profile
                    try:
                        converted_cart = json.loads(saved_cart)
                        for product_id, item in converted_cart.items():
                            product = Property.objects.get(id=int(product_id))
                            self.add(product=product, quantity=item['quantity'], update_quantity=True)
                    except json.JSONDecodeError:
                        pass  # Handle invalid saved cart data
            except Profile.DoesNotExist:
                pass  # Handle case where the profile doesn't exist

# db_add

<!--  search-->

  {% extends 'base.html' %}

{% block title %}
EAsybUy | Search Product
{% endblock %}

{% block content %}
<h1>Find What You Are Looking For...</h1>

<div class="card">
  <div class="card-header">
    Search Products
  </div>
  <div class="card-body">
    <form method="POST" action="{% url 'search' %}">
        {% csrf_token %}
        <div class="mb-3">
            <input type="text" class="form-control" name="query" placeholder="Search for Properties...">
        </div>
        <button type="submit" class="btn btn-success">Search</button>
    </form>
  </div>
</div>

{% if searched %}
    <div class="results">
        <h2>Search Results:</h2>
        {% for property in searched %}
            <div class="result-item">
                <h3>{{ property.title }}</h3>
                <p><strong>Price:</strong> {{ property.price }}</p>
                <p><strong>Location:</strong> {{ property.location }}</p>
                <p><strong>Beds:</strong> {{ property.beds }}</p>
                <p><strong>Baths:</strong> {{ property.baths }}</p>
                <p><strong>Garage:</strong> {{ property.garage }}</p>
                <p><strong>Area:</strong> {{ property.area }}</p>
                <p><strong>Status:</strong> {{ property.status }}</p>
                <p><strong>Description:</strong> {{ property.description }}</p>
                {% if property.image %}
                    <img src="{{ property.image.url }}" alt="{{ property.title }}" class="img-fluid">
                {% else %}
                    <p>No image available for this property.</p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}

<!--  search.view-->

  def search(request):
    query = request.GET.get('query', '')  # Use GET method to retrieve the search query
    if query:
        # Perform search on multiple fields
        searched = Property.objects.filter(
            Q(title__icontains=query) |
            Q(description__icontains=query) |
            Q(location__icontains=query) |
            Q(status__icontains=query) |
            Q(price__icontains=query) |
            Q(area__icontains=query) |
            Q(baths__icontains=query) |
            Q(garage__icontains=query) |
            Q(key__icontains=query) |
            Q(propertytype__icontains=query)
        )
    else:
        searched = Property.objects.none()  # Return empty queryset if no query
    return render(request, 'search.html', {'searched': searched})


<!--  cart.html-->

  {% extends 'base.html' %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4">Your Cart</h2>

    {% if cart.items|length > 0 %}
        <!-- Cart Items -->
        <div class="row">
            {% for item in cart.items %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <!-- Property Image -->
                        <img src="{{ item.property.image.url }}" alt="{{ item.property.title }}" class="card-img-top" style="height: 200px; object-fit: cover;">

                        <div class="card-body">
                            <!-- Property Title -->
                            <h5 class="card-title">{{ item.property.title }}</h5>
                            <!-- Property Price and Total -->
                            <p class="card-text">Price: ${{ item.price }}</p>
                            <p class="card-text">Quantity: {{ item.quantity }}</p>
                            <p class="card-text"><strong>Total Price:</strong> ${{ item.total_price }}</p>
                        </div>

                        <div class="card-footer d-flex justify-content-between">
                            <!-- Remove Button -->
                            <a href="{% url 'remove_from_cart' property_id=item.property.id %}"
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('Are you sure you want to remove this item?');">
                                Remove
                            </a>
                            <!-- Reserve Button -->
                            <a href="{% url 'billing' property_id=item.property.id %}"
                               class="btn btn-success btn-sm">
                                Reserve
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Total Price -->
        <div class="text-end mt-4">
            <h4>Total Price: ${{ cart.get_total_price }}</h4>
            <a href="{% url 'checkout' %}" class="btn btn-primary">Proceed to Checkout</a>
        </div>

    {% else %}
        <!-- Empty Cart Message -->
        <div class="alert alert-warning text-center" role="alert">
            Your cart is empty. <a href="{% url 'property_list' %}" class="alert-link">Browse properties</a> to add items.
        </div>
    {% endif %}
</div>
{% endblock %}

<!--  suggested apiview-->

  from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework import status
from django.core.exceptions import ObjectDoesNotExist
from .models import Profile
from .serializers import CustomerSerializer

@api_view(['GET', 'POST'])
def customerapi(request):
    if request.method == 'GET':
        try:
            profile = Profile.objects.get(user=request.user)
            serializer = CustomerSerializer(profile)
            return Response(serializer.data, status=status.HTTP_200_OK)
        except ObjectDoesNotExist:
            return Response({'error': 'Profile not found for the user.'}, status=status.HTTP_404_NOT_FOUND)

    elif request.method == 'POST':
        serializer = CustomerSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)


  <a href="{% url 'remove_from_cart' property_id=item.property.id %}" class="btn btn-danger">Remove</a>
                <!-- Button to reserve the property (Proceed to billing) -->
                <a href="{% url 'billing' property_id=item.property.id %}" class="btn btn-success" type="button">Reserve</a>

  .hero {
  padding: 0;
}

.hero .carousel {
  width: 100%;
  min-height: 100vh;
  padding: 0;
  margin: 0;
  background-color: var(--background-color);
  position: relative;
  overflow: hidden;
}

.hero img {
  position: absolute;
  inset: 0;
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 1;
}

.hero .carousel-item {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  overflow: hidden;
}

.hero .carousel-item:before {
  content: "";
  background: color-mix(in srgb, var(--background-color), transparent 60%);
  position: absolute;
  inset: 0;
  z-index: 2;
}

.hero .carousel-container {
  position: absolute;
  inset: 90px 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 3;
}

@media (max-width: 575px) {
  .hero .carousel-container {
    inset: 90px 50px;
  }
}

.hero h2 {
  margin-bottom: 30px;
  font-size: 56px;
  font-weight: 900;
  text-transform: uppercase;
}

.hero h2 span {
  color: var(--accent-color);
}

@media (max-width: 768px) {
  .hero h2 {
    font-size: 30px;
  }
}

.hero .btn-get-started {
  color: var(--contrast-color);
  font-family: var(--heading-font);
  font-weight: 600;
  font-size: 18px;
  letter-spacing: 1px;
  text-transform: uppercase;
  display: inline-block;
  padding: 10px 40px;
  border-radius: 50px;
  transition: 0.5s;
  margin: 10px 0;
  align-self: flex-start;
  flex-shrink: 0;
  border: 2px solid var(--accent-color);
}

.hero .btn-get-started:hover {
  background: color-mix(in srgb, var(--accent-color), transparent 20%);
}

.hero .carousel-control-prev,
.hero .carousel-control-next {
  width: 10%;
  transition: 0.3s;
  opacity: 0.5;
  z-index: 3;
}

.hero .carousel-control-prev:focus,
.hero .carousel-control-next:focus {
  opacity: 0.5;
}

.hero .carousel-control-prev:hover,
.hero .carousel-control-next:hover {
  opacity: 0.9;
}

@media (min-width: 1024px) {

  .hero .carousel-control-prev,
  .hero .carousel-control-next {
    width: 5%;
  }
}

.hero .carousel-control-next-icon,
.hero .carousel-control-prev-icon {
  background: none;
  font-size: 32px;
  line-height: 1;
}

.hero .carousel-indicators {
  list-style: none;
}

.hero .carousel-indicators li {
  cursor: pointer;
  opacity: 1;
  height: 6px;
  width: 20px;
  transition: 0.3s;
  padding: 0;
}

.hero .carousel-indicators .active {
  background-color: var(--accent-color);
  width: 40px;
}





  .agents .member {
  position: relative;
}

.agents .member .pic {
  overflow: hidden;
  margin-bottom: 50px;
}

.agents .member .member-info {
  background-color: var(--surface-color);
  color: color-mix(in srgb, var(--default-color), transparent 20%);
  box-shadow: 0px 2px 15px rgba(0, 0, 0, 0.1);
  position: absolute;
  bottom: -50px;
  left: 20px;
  right: 20px;
  padding: 20px 15px;
  overflow: hidden;
  transition: 0.5s;
}

.agents .member h4 {
  font-weight: 700;
  margin-bottom: 10px;
  font-size: 16px;
  position: relative;
  padding-bottom: 10px;
}

.agents .member h4::after {
  content: "";
  position: absolute;
  display: block;
  width: 50px;
  height: 1px;
  background: color-mix(in srgb, var(--default-color), transparent 60%);
  bottom: 0;
  left: 0;
}

.agents .member span {
  font-style: italic;
  display: block;
  font-size: 13px;
}

.agents .member .social {
  position: absolute;
  right: 15px;
  bottom: 15px;
}

.agents .member .social a {
  transition: color 0.3s;
  color: color-mix(in srgb, var(--default-color), transparent 70%);
}

.agents .member .social a:hover {
  color: var(--accent-color);
}

.agents .member .social i {
  font-size: 16px;
  margin: 0 2px;
}
